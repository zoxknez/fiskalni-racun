================================================================================
ANALIZA APLIKACIJE - FISKALNI RAƒåUN
================================================================================
Datum analize: 01.12.2025.
Poslednje a≈æuriranje: 01.12.2025.
================================================================================

================================================================================
üî¥ KRITIƒåNI PROBLEMI (MORAJU SE POPRAVITI)
================================================================================

[K1] src/lib/neon/config.ts - Linije 20-21
     PROBLEM: Hardkodirani DB kredencijali u fallback-u
     OPIS: Database connection string sa lozinkom je vidljiv u kodu
     RE≈†ENJE: Ukloniti fallback, baciti error ako env var ne postoji
     STATUS: [‚úÖ] POPRAVLJENO

[K2] src/lib/neon/auth.ts - Linije 44-46
     PROBLEM: SHA-256 sa statiƒçkim salt-om za hashovanje lozinki
     OPIS: SHA-256 nije dizajniran za lozinke, salt mora biti random po korisniku
     RE≈†ENJE: Koristiti PBKDF2 ili prebaciti hashing na server
     STATUS: [‚úÖ] POPRAVLJENO - Implementiran PBKDF2 sa random salt

[K3] public/sw-custom.js - Linije 7-12
     PROBLEM: ES module import u service worker-u
     OPIS: Service worker u public folderu ne mo≈æe koristiti ES import sintaksu
     RE≈†ENJE: Koristiti injectManifest umesto generateSW, ili importScripts()
     STATUS: [‚úÖ] POPRAVLJENO - Prebaƒçeno na injectManifest sa src/sw.ts

[K4] lib/db.ts - Linije 329-331
     PROBLEM: Async deleting hook - Dexie ne ƒçeka async
     OPIS: Dexie ne await-uje async hook funkcije pravilno
     RE≈†ENJE: Obrisati reminder-e pre brisanja device-a u deleteDevice funkciji
     STATUS: [‚úÖ] POPRAVLJENO - deleteDevice koristi transakciju za eksplicitno brisanje

================================================================================
üü† VISOKI PRIORITET
================================================================================

[V1] src/pages/ReceiptDetailPage.tsx - Linija 134
     PROBLEM: Navigacija na /receipts/${id}/edit - ruta ne postoji
     OPIS: Edit dugme vodi na nepostojeƒáu stranicu
     RE≈†ENJE: Kreirati EditReceiptPage ili ukloniti Edit dugme
     STATUS: [‚úÖ] POPRAVLJENO - Kreiran EditReceiptPage.tsx i dodana ruta

[V2] src/lib/fiscalQRParser.ts - Linije 53-58
     PROBLEM: Nema validacije du≈æine dateStr pre substring
     OPIS: Ako dateStr ima manje od 12 karaktera, parser ƒáe vratiti pogre≈°ne podatke
     RE≈†ENJE: Dodati validaciju du≈æine: if (dateStr.length !== 12) return null
     STATUS: [‚úÖ] POPRAVLJENO

[V3] src/lib/fiscalQRParser.ts
     PROBLEM: Nema validacije PIB formata
     OPIS: PIB u Srbiji mora imati taƒçno 9 cifara
     RE≈†ENJE: Dodati regex validaciju: /^\d{9}$/
     STATUS: [‚úÖ] POPRAVLJENO

[V4] src/lib/fiscalQRParser.ts
     PROBLEM: Nema parsiranja PDV (VAT) iznosa
     OPIS: Srpski fiskalni raƒçuni sadr≈æe PDV ali se ne parsira
     RE≈†ENJE: Dodati parsiranje PDV polja
     STATUS: [‚úÖ] POPRAVLJENO - Dodano polje vatAmount

[V5] src/pages/AddReceiptPageSimplified.tsx - Linije 256-267
     PROBLEM: Race condition izmeƒëu timeout-a i onload-a
     OPIS: I timeout i onload mogu se izvr≈°iti ako se onload desi tik posle timeout-a
     RE≈†ENJE: Koristiti flag za praƒáenje da li je veƒá obraƒëeno
     STATUS: [‚úÖ] POPRAVLJENO - Dodan 'handled' flag

[V6] vite.config.ts - Linija 341
     PROBLEM: tesseract.js u optimizeDeps.include
     OPIS: Tesseract.js je 11MB+ biblioteka, ne treba je pre-bundle-ovati
     RE≈†ENJE: Ukloniti iz include liste - veƒá ima lazy loading
     STATUS: [‚úÖ] POPRAVLJENO - Uklonjen iz include liste

[V7] capacitor.config.ts
     PROBLEM: Nedostaje Keyboard i StatusBar plugin konfiguracija
     OPIS: Na iOS-u keyboard mo≈æe uzrokovati viewport probleme
     RE≈†ENJE: Dodati konfiguraciju za Keyboard i StatusBar plugine
     STATUS: [‚úÖ] POPRAVLJENO - Dodana kompletna konfiguracija

================================================================================
üü° SREDNJI PRIORITET
================================================================================

[S1] src/store/useAppStore.ts - Linije 55-61
     PROBLEM: persistedState cast bez validacije
     OPIS: Direktno castovanje unknown na AppStore bez provere strukture
     RE≈†ENJE: Dodati Zod validaciju za persisted state
     STATUS: [‚úÖ] POPRAVLJENO - Dodana Zod schema validacija

[S2] vite.config.ts - Linija 335
     PROBLEM: Samo debugger se uklanja u produkciji
     OPIS: console.log ostaje u production build-u
     RE≈†ENJE: Dodati 'console' u drop niz za produkciju
     STATUS: [‚úÖ] POPRAVLJENO - Dodano pure: ['console.log', 'console.info', 'console.debug']

[S3] src/components/scanner/QRScanner.tsx - Linije 185-193
     PROBLEM: Video element nema accessible name
     OPIS: Screen reader-i ne mogu pravilno opisati video element
     RE≈†ENJE: Dodati aria-label="QR Scanner Camera Feed"
     STATUS: [‚úÖ] POPRAVLJENO - Dodan <section> sa aria-label

[S4] src/lib/fiscalQRParser.ts
     PROBLEM: Nema podr≈°ke za ƒáirilicu u merchant name
     OPIS: Srpski prodavci mogu imati ƒáiriliƒçna imena
     RE≈†ENJE: Proveriti da li decodeURIComponent pravilno handle-uje UTF-8
     STATUS: [ ] NIJE POPRAVLJENO - Nije kritiƒçno, decodeURIComponent podr≈æava UTF-8

================================================================================
üü¢ POBOLJ≈†ANJA (NICE TO HAVE)
================================================================================

[P1] vite.config.ts - PWA screenshots
     PROBLEM: Screenshots mo≈æda ne postoje
     OPIS: /screenshots/home.png i /screenshots/receipts.png referencirani ali mo≈æda ne postoje
     RE≈†ENJE: Kreirati screenshots ili ukloniti iz manifesta
     STATUS: [ ] NIJE POPRAVLJENO

[P2] Blob URL za slike
     PROBLEM: Blob URL-ovi ne pre≈æivljavaju refresh
     OPIS: Slike uploadovane kao blob se gube posle refresh-a
     RE≈†ENJE: Konvertovati u base64 ili ƒçuvati u IndexedDB
     STATUS: [ ] NIJE POPRAVLJENO

[P3] Nedostaje EditReceiptPage
     PROBLEM: Korisnici ne mogu editovati postojeƒáe raƒçune
     OPIS: Samo delete je dostupan, nema edit funkcionalnosti
     RE≈†ENJE: Kreirati EditReceiptPage sa istim formom kao AddReceipt
     STATUS: [‚úÖ] POPRAVLJENO - Kreirana kompletna EditReceiptPage

================================================================================
NAPREDAK
================================================================================

Ukupno problema: 15
Popravljeno: 14
Preostalo: 1 (nisu kritiƒçni - S4 + nice-to-have P1, P2)

Biome check: ‚úÖ 0 gre≈°aka, 6 upozorenja (hardkodirani ID-ovi - preporuke)

Poslednje a≈æuriranje: 01.12.2025.

================================================================================
